---
title: How to Create a Personalized RAG Chatbot from Scratch
date: 2025-7-4
tags: ['python', 'AI', 'chatbot', 'RAG', 'transformers', 'streamlit', 'langchain', 'machine learning', 'deeplearning' ]
summary: BÃ i viáº¿t nÃ y cung cáº¥p hÆ°á»›ng dáº«n chi tiáº¿t cÃ¡ch táº¡o vÃ  triá»ƒn khai má»™t chatbot RAG cÃ¡ nhÃ¢n hÃ³a báº±ng Python, sá»­ dá»¥ng cÃ¡c thÆ° viá»‡n nhÆ° Transformers, LangChain vÃ  giao diá»‡n trá»±c quan vá»›i Streamlit.
---

import Twemoji from './components/ui/Twemoji';

## Táº¡i sao láº¡i lÃ  RAG?

- Giá»›i thiá»‡u khÃ¡i niá»‡m **Retrieval-Augmented Generation (RAG)**.
  - Váº¥n Ä‘á» cá»§a LLMs khi khÃ´ng cÃ³ thÃ´ng tin thá»i gian thá»±c hoáº·c dá»¯ liá»‡u cá»¥ thá»ƒ.
  - Giáº£i phÃ¡p RAG: káº¿t há»£p kháº£ nÄƒng sinh vÄƒn báº£n cá»§a LLM vá»›i há»‡ thá»‘ng truy xuáº¥t dá»¯ liá»‡u tá»« nguá»“n bÃªn ngoÃ i.
- á»¨ng dá»¥ng thá»±c táº¿ cá»§a RAG: chatbot chÄƒm sÃ³c khÃ¡ch hÃ ng, tÆ° váº¥n kiáº¿n thá»©c chuyÃªn ngÃ nh, há»‡ thá»‘ng ná»™i bá»™ doanh nghiá»‡p,...
- Trong project nÃ y, má»¥c tiÃªu lÃ  táº¡o má»™t chatbot cÃ³ kháº£ nÄƒng tráº£ lá»i cÃ¡c cÃ¢u há»i xoay quanh má»™t chá»§ Ä‘á» cÃ¡ nhÃ¢n (vÃ­ dá»¥: blog cá»§a báº¡n, sáº£n pháº©m cÃ¡ nhÃ¢n, kiáº¿n thá»©c chuyÃªn sÃ¢u,...)

---

## Tá»•ng quan dá»± Ã¡n

- MÃ´ táº£ luá»“ng hoáº¡t Ä‘á»™ng tá»•ng thá»ƒ cá»§a chatbot RAG:
  1. Nháº­n cÃ¢u há»i tá»« ngÆ°á»i dÃ¹ng
  2. DÃ¹ng embedding Ä‘á»ƒ tÃ¬m cÃ¡c Ä‘oáº¡n vÄƒn báº£n liÃªn quan trong táº­p dá»¯ liá»‡u cÃ¡ nhÃ¢n
  3. ÄÆ°a káº¿t quáº£ truy xuáº¥t + cÃ¢u há»i vÃ o LLM Ä‘á»ƒ táº¡o cÃ¢u tráº£ lá»i
- Giá»›i thiá»‡u cÃ´ng nghá»‡ sá»­ dá»¥ng:
  - Python
  - LangChain (quáº£n lÃ½ pipeline RAG)
  - Hugging Face Transformers (mÃ´ hÃ¬nh ngÃ´n ngá»¯ + embeddings)
  - FAISS hoáº·c ChromaDB (vector store)
  - Streamlit (táº¡o giao diá»‡n web Ä‘Æ¡n giáº£n)

---

## CÃ¡c bÆ°á»›c xÃ¢y dá»±ng dá»± Ã¡n

### BÆ°á»›c 1: CÃ i Ä‘áº·t mÃ´i trÆ°á»ng vÃ  thÆ° viá»‡n cáº§n thiáº¿t

- **Äá»‘i vá»›i Google Colab**: Náº¿u báº¡n sá»­ dá»¥ng Google Colab, chá»‰ cáº§n cháº¡y cÃ¡c lá»‡nh sau Ä‘á»ƒ cÃ i Ä‘áº·t cÃ¡c thÆ° viá»‡n cáº§n thiáº¿t:
  ```bash
  !pip install -q transformers==4.52.4
  !pip install -q bitsandbytes==0.46.0
  !pip install -q accelerate==1.7.0
  !pip install -q langchain==0.3.25
  !pip install -q langchainhub==0.1.21
  !pip install -q langchain-chroma==0.2.4
  !pip install -q langchain_experimental==0.3.4
  !pip install -q langchain-community==0.3.24
  !pip install -q langchain_huggingface==0.2.0
  !pip install -q python-dotenv==1.1.0
  !pip install -q pypdf
  ```

- **Äá»‘i vá»›i mÃ´i trÆ°á»ng local**: Náº¿u báº¡n cháº¡y trÃªn mÃ¡y local, cáº§n thiáº¿t láº­p mÃ´i trÆ°á»ng Conda trÆ°á»›c. DÆ°á»›i Ä‘Ã¢y lÃ  má»™t file `environment.yaml` máº«u Ä‘á»ƒ táº¡o mÃ´i trÆ°á»ng:
  ```yaml
  name: myenv
  channels:
    - pytorch
    - nvidia
    - conda-forge
    - defaults
  dependencies:
    - python=3.12
    - numpy
    - pytorch=2.2.2
    - pytorch-cuda=11.8
  ```
  Äá»ƒ táº¡o mÃ´i trÆ°á»ng tá»« file YAML nÃ y, lÆ°u ná»™i dung vÃ o file `environment.yaml`, sau Ä‘Ã³ cháº¡y lá»‡nh:
  ```bash
  conda env create -f environment.yaml
  ```
  Sau khi mÃ´i trÆ°á»ng Ä‘Æ°á»£c táº¡o, kÃ­ch hoáº¡t mÃ´i trÆ°á»ng báº±ng lá»‡nh:
  ```bash
  conda activate myenv
  ```
  Tiáº¿p theo, cÃ i Ä‘áº·t cÃ¡c thÆ° viá»‡n cáº§n thiáº¿t báº±ng lá»‡nh:
  ```bash
  pip install -r requirements.txt
  ```
  Ná»™i dung file `requirements.txt` nÃªn bao gá»“m:
  ```
  transformers==4.52.4
  bitsandbytes==0.46.0
  accelerate==1.7.0
  langchain==0.3.25
  langchainhub==0.1.21
  langchain-chroma==0.2.4
  langchain_experimental==0.3.4
  langchain-community==0.3.24
  langchain_huggingface==0.2.0
  python-dotenv==1.1.0
  pypdf
  ```

Sau khi cÃ i Ä‘áº·t xong mÃ´i trÆ°á»ng thÃ¬ **xin chÃºc má»«ng báº¡n** Ä‘Ã£ vÆ°á»£t qua cá»­a áº£i Ä‘áº§u tiÃªn.

![ChÃºc má»«ng báº¡n!](/static/images/blogs/blender-anya.png)

### BÆ°á»›c 2: XÃ¢y dá»±ng há»‡ thá»‘ng lÆ°u trá»¯ cÃ¡c vector embedding

- **Import cÃ¡c thÆ° viá»‡n cáº§n thiáº¿t**: Äáº§u tiÃªn, báº¡n cáº§n import cÃ¡c thÆ° viá»‡n Ä‘á»ƒ xÃ¢y dá»±ng há»‡ thá»‘ng:
  ```python
  import torch
  from transformers import BitsAndBytesConfig
  from transformers import AutoTokenizer, AutoModelForCausalLM, pipeline
  from langchain_huggingface import HuggingFaceEmbeddings
  from langchain_huggingface.llms import HuggingFacePipeline
  from langchain.memory import ConversationBufferMemory
  from langchain_community.chat_message_histories import ChatMessageHistory
  from langchain_community.document_loaders import PyPDFLoader, TextLoader
  from langchain.chains import ConversationalRetrievalChain
  from langchain_experimental.text_splitter import SemanticChunker
  from langchain_chroma import Chroma
  from langchain_text_splitters import RecursiveCharacterTextSplitter
  from langchain_core.runnables import RunnablePassthrough
  from langchain_core.output_parsers import StrOutputParser
  from langchain import hub
  ```

- **Äá»c file PDF**: Báº¡n hÃ£y chuáº©n bá»‹ vÃ  upload má»™t file PDF táº§m 20 trang trá»Ÿ lÃªn Ä‘á»ƒ test khi xÃ¢y dá»±ng há»‡ thá»‘ng. Sau Ä‘Ã³, sá»­ dá»¥ng class `PyPDFLoader` Ä‘á»ƒ Ä‘á»c file PDF nÃ y lÃªn nhÆ° sau:
  ```python
  Loader = PyPDFLoader
  FILE_PATH = "ten_file_cua_ban.pdf"
  loader = Loader(FILE_PATH)
  documents = loader.load()
  ```
- **Embedding model**: LÃ  mÃ´ hÃ¬nh giÃºp vector hÃ³a cÃ¡c vÄƒn báº£n nháº±n thá»±c hiá»‡n viá»‡c tÃ­nh toÃ¡n vÃ  lÆ°u trá»¯, dÆ°á»›i Ä‘Ã¢y lÃ  cÃ¡ch sá»­ dá»¥ng HuggingFaceEmbeddings vá»›i mÃ´ hÃ¬nh bkai-foundation-models/vietnamese-bi-encoder Ä‘Æ°á»£c train Ä‘á»ƒ hiá»ƒu ngá»¯ nghÄ©a vá»›i tiáº¿ng Viá»‡t.

  ```python
  EMBEDDING_MODEL_NAME = "bkai-foundation-models/vietnamese-bi-encoder"
  embeddings = HuggingFaceEmbeddings(model_name=EMBEDDING_MODEL_NAME)
  ```
- **Chunking**: TÃ¡ch vÄƒn báº£n dÃ i thÃ nh cÃ¡c Ä‘oáº¡n ngáº¯n hÆ¡n thay vÃ¬ sá»­ dá»¥ng cÃ¡c phÆ°Æ¡ng phÃ¡p truyá»n thá»‘ng chá»‰ tÃ¡ch cÃ¡c vÄƒn báº£n theo Ä‘á»™ dÃ i thÃ¬ mÃ¬nh sáº½ sá»­ dá»¥ng ká»¹ thuáº­t **Semantic Chunking** Ä‘á»ƒ tÃ¡ch nhÆ°ng sáº½ dá»±a vÃ o má»©c Ä‘á»™ ngá»¯ nghÄ©a Ä‘á»ƒ trÃ¡nh lÃ m vá»¡ máº¡ch vÄƒn vÃ  chia nhá» cÃ¡c Ä‘oáº¡n cÃ³ cÃ¹ng má»™t chá»§ Ä‘á». DÆ°á»›i Ä‘Ã¢y lÃ  cÃ¡ch sá»­ dá»¥ng SemanticChunker Ä‘á»ƒ triá»ƒn khai:
![ChÃºc má»«ng báº¡n Ä‘Ã£ Ä‘á»c xong!](/static/images/blogs/rag-chatbot/Slide1.PNG)
  ```python
  semantic_splitter = SemanticChunker(
    embeddings=embeddings,
    buffer_size=1,
    breakpoint_threshold_type="percentile",
    breakpoint_threshold_amount=95,
    min_chunk_size=500,
    add_start_index=True
  )
  ```
  Giáº£i thÃ­ch cÃ¡c tham sá»‘:
  - `embeddings`: ÄÃ¢y lÃ  mÃ´ hÃ¬nh embedding Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ tÃ­nh toÃ¡n ngá»¯ nghÄ©a cá»§a vÄƒn báº£n. MÃ´ hÃ¬nh nÃ y giÃºp xÃ¡c Ä‘á»‹nh má»©c Ä‘á»™ liÃªn quan vá» máº·t ná»™i dung giá»¯a cÃ¡c cÃ¢u hoáº·c Ä‘oáº¡n vÄƒn, tá»« Ä‘Ã³ há»— trá»£ viá»‡c tÃ¡ch Ä‘oáº¡n má»™t cÃ¡ch chÃ­nh xÃ¡c hÆ¡n.
  - `buffer_size`: Tham sá»‘ nÃ y xÃ¡c Ä‘á»‹nh sá»‘ lÆ°á»£ng cÃ¢u hoáº·c Ä‘oáº¡n vÄƒn Ä‘Æ°á»£c giá»¯ trong bá»™ Ä‘á»‡m Ä‘á»ƒ phÃ¢n tÃ­ch ngá»¯ nghÄ©a. Vá»›i giÃ¡ trá»‹ `1` cÃ³ nghÄ©a lÃ  1 nhÃ³m gá»“m 1 cÃ¢u.
  - `breakpoint_threshold_type`: ÄÃ¢y lÃ  loáº¡i ngÆ°á»¡ng Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ xÃ¡c Ä‘á»‹nh Ä‘iá»ƒm cáº¯t giá»¯a cÃ¡c Ä‘oáº¡n. GiÃ¡ trá»‹ `"percentile"` cho biáº¿t ngÆ°á»¡ng Ä‘Æ°á»£c tÃ­nh dá»±a trÃªn tá»‰ lá»‡ pháº§n trÄƒm cá»§a sá»± khÃ¡c biá»‡t ngá»¯ nghÄ©a giá»¯a cÃ¡c cÃ¢u hoáº·c Ä‘oáº¡n.
  - `breakpoint_threshold_amount`: Vá»›i giÃ¡ trá»‹ `95`, ngÆ°á»¡ng cáº¯t Ä‘Æ°á»£c Ä‘áº·t á»Ÿ phÃ¢n vá»‹ thá»© 95. Äiá»u nÃ y cÃ³ nghÄ©a lÃ  chá»‰ khi sá»± khÃ¡c biá»‡t vá» ngá»¯ nghÄ©a giá»¯a hai cÃ¢u hoáº·c Ä‘oáº¡n vÆ°á»£t quÃ¡ 95% cÃ¡c giÃ¡ trá»‹ khÃ¡c biá»‡t khÃ¡c thÃ¬ Ä‘iá»ƒm cáº¯t má»›i Ä‘Æ°á»£c táº¡o.
  - `min_chunk_size`: ÄÃ¢y lÃ  kÃ­ch thÆ°á»›c tá»‘i thiá»ƒu cá»§a má»™t Ä‘oáº¡n vÄƒn sau khi cáº¯t, Ä‘Æ°á»£c Ä‘áº·t lÃ  `500` kÃ½ tá»±. Tham sá»‘ nÃ y Ä‘áº£m báº£o ráº±ng cÃ¡c Ä‘oáº¡n khÃ´ng bá»‹ chia quÃ¡ nhá», giÃºp duy trÃ¬ Ã½ nghÄ©a vÃ  máº¡ch vÄƒn.
  - `add_start_index`: Khi Ä‘Æ°á»£c Ä‘áº·t lÃ  `True`, tham sá»‘ nÃ y thÃªm chá»‰ sá»‘ báº¯t Ä‘áº§u vÃ o metadata cá»§a má»—i Ä‘oáº¡n. Äiá»u nÃ y há»¯u Ã­ch Ä‘á»ƒ theo dÃµi vá»‹ trÃ­ cá»§a Ä‘oáº¡n trong vÄƒn báº£n gá»‘c, Ä‘áº·c biá»‡t khi cáº§n tham chiáº¿u ngÆ°á»£c láº¡i.
  


### BÆ°á»›c 3: Káº¿t ná»‘i vá»›i mÃ´ hÃ¬nh LLM
- DÃ¹ng mÃ´ hÃ¬nh pre-trained (nhÆ° `gpt-4`, `mistral`, `phi`, hoáº·c `Llama`) Ä‘á»ƒ sinh cÃ¢u tráº£ lá»i tá»« Ä‘oáº¡n vÄƒn Ä‘Æ°á»£c truy xuáº¥t

### BÆ°á»›c 4: XÃ¢y dá»±ng giao diá»‡n vá»›i Streamlit
- Táº¡o form nháº­p cÃ¢u há»i
- Hiá»ƒn thá»‹ cÃ¢u tráº£ lá»i, cÃ¹ng pháº§n nguá»“n truy xuáº¥t (náº¿u cáº§n)
- Giao diá»‡n Ä‘Æ¡n giáº£n, dá»… dÃ¹ng

### Äiá»ƒm cáº£i tiáº¿n cÃ³ thá»ƒ Ä‘á» cáº­p:
- Cáº£i thiá»‡n cháº¥t lÆ°á»£ng embedding (dÃ¹ng mÃ´ hÃ¬nh khÃ¡c)
- DÃ¹ng RAG vá»›i mÃ´ hÃ¬nh local (open-source)

---

## Triá»ƒn khai vÃ  kiá»ƒm thá»­

- CÃ¡ch cháº¡y thá»­ trÃªn local
- CÃ¡c lÆ°u Ã½ khi triá»ƒn khai:
  - KÃ­ch thÆ°á»›c dá»¯ liá»‡u áº£nh hÆ°á»Ÿng Ä‘áº¿n thá»i gian pháº£n há»“i

---

## Tá»•ng káº¿t (Summary)

- TÃ³m táº¯t láº¡i quÃ¡ trÃ¬nh:
  - Thu tháº­p dá»¯ liá»‡u â†’ táº¡o embedding â†’ truy xuáº¥t vÄƒn báº£n â†’ sinh cÃ¢u tráº£ lá»i â†’ giao diá»‡n
- Nhá»¯ng cÃ´ng nghá»‡ Ä‘Ã£ há»c Ä‘Æ°á»£c qua bÃ i:
  - LangChain, Vector DB, Transformers, Streamlit
- Gá»£i Ã½ nÃ¢ng cáº¥p:
  - Giao diá»‡n Ä‘áº¹p hÆ¡n (Streamlit component)
  - Chat history

---

## ğŸ‰ ChÃºc má»«ng báº¡n Ä‘Ã£ Ä‘á»c xong bÃ i viáº¿t!
![ChÃºc má»«ng báº¡n Ä‘Ã£ Ä‘á»c xong!](/static/images/blogs/anya-chucmung.png)
